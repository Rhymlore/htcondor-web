---
title: Yum Repo Mirror
layout: wiki-page
---
<div id="content">
 <span class="section">
  <h2>
   Mirroring the HTCondor YUM Repository
  </h2>
 </span>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Motivation
 </h3>
 Some of our collaborators in Europe or other continents would like to keep a locally available mirror for the ease of updating their YUM installs of HTCondor
in large pools. Since all of the HTCondor YUM repository is already publicly available, there is no enforceability to restrict the mirroring of it. Hence it is made available.
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  UW-Madison Server Configuration
 </h3>
 This section is information for the HTCondor Team.
 <p>
  On
  <code>
   parrot.cs.wisc.edu
  </code>
  , in the
  <code>
   /etc/rsyncd.conf
  </code>
  file, you will find these
configurations. They were set up by the CSL at the HTCondor Team's request and are maintained by the CSL. The HTCondor Team uses the usual channels to communicate with the CSL when this configuration needs changing. There should
be nothing surprising or confidential in this configuration.
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code">[condor-yum-development]
path=/p/condor/public/html/yum/development
read only = true
uid=nobody
gid=nobody

[condor-yum-stable]
path=/p/condor/public/html/yum/stable
read only = true
uid=nobody
gid=nobody

[condor-yum-repo.d]
path=/p/condor/public/html/yum/repo.d
read only = true
uid=nobody
gid=nobody
</pre>
 </div>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Mirror Site Actions
 </h3>
 This section is information for those wishing to mirror the repository.
 <p>
  One would mirror the HTCondor YUM repository with these commands. There are
large files in this repo and it could take a while to perform the copy.
 </p>
 <p>
 </p>
 <div class="code">
  <pre class="code">&gt; mkdir &lt;path&gt;/yum
&gt; cd &lt;path&gt;/yum
&gt; rsync -av rsync://parrot.cs.wisc.edu/condor-yum-development development
&gt; rsync -av rsync://parrot.cs.wisc.edu/condor-yum-stable stable
&gt; rsync -av rsync://parrot.cs.wisc.edu/condor-yum-repo.d repo.d
</pre>
 </div>
 <p>
  The finished directory structure will look like this:
 </p>
 <p>
 </p>
 <ul>
  <li>
   <code>
    &lt;path&gt;/yum
   </code>
   <ul>
    <li>
     <code>
      /development
     </code>
     - Contains Development Repositories
     <ul>
      <li>
       <code>
        /rhel4
       </code>
       - The Rhel 4 release of HTCondor
       <ul>
        <li>
         <code>
          /condor-7.5.-*
         </code>
         - The development version RPM files for RHEL4
        </li>
        <li>
         <code>
          /repodata
         </code>
         - The index files for this portion of the repo.
         <ul>
          <li>
           <code>
            /filelists.xml.gz
           </code>
          </li>
          <li>
           <code>
            /other.xml.gz
           </code>
          </li>
          <li>
           <code>
            /primary.xml.gz
           </code>
          </li>
          <li>
           <code>
            /repomd.xml
           </code>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li>
       <code>
        /rhel5
       </code>
       - The Rhel 5 release of HTCondor
       <ul>
        <li>
         <code>
          /condor-7.5.-*
         </code>
         - The development version RPM files for RHEL5
        </li>
        <li>
         <code>
          /repodata
         </code>
         - The index files for this portion of the repo.
         <ul>
          <li>
           <code>
            /filelists.xml.gz
           </code>
          </li>
          <li>
           <code>
            /other.xml.gz
           </code>
          </li>
          <li>
           <code>
            /primary.xml.gz
           </code>
          </li>
          <li>
           <code>
            /repomd.xml
           </code>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </li>
    <li>
     <code>
      /stable
     </code>
     - Contains Stable Repositories
     <ul>
      <li>
       <code>
        /rhel4
       </code>
       - The Rhel 4 release of HTCondor
       <ul>
        <li>
         <code>
          /condor-7.4.-*
         </code>
         - The stable version RPM files for RHEL4
        </li>
        <li>
         <code>
          /repodata
         </code>
         - The index files for this portion of the repo.
         <ul>
          <li>
           <code>
            /filelists.xml.gz
           </code>
          </li>
          <li>
           <code>
            /other.xml.gz
           </code>
          </li>
          <li>
           <code>
            /primary.xml.gz
           </code>
          </li>
          <li>
           <code>
            /repomd.xml
           </code>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li>
       <code>
        /rhel5
       </code>
       - The Rhel 5 release of HTCondor
       <ul>
        <li>
         <code>
          /condor-7.4.-*
         </code>
         - The stable version RPM files for RHEL5
        </li>
        <li>
         <code>
          /repodata
         </code>
         - The index files for this portion of the repo.
         <ul>
          <li>
           <code>
            /filelists.xml.gz
           </code>
          </li>
          <li>
           <code>
            /other.xml.gz
           </code>
          </li>
          <li>
           <code>
            /primary.xml.gz
           </code>
          </li>
          <li>
           <code>
            /repomd.xml
           </code>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </li>
    <li>
     <code>
      /repo.d
     </code>
     - Store repo files that describe the yum repo locations
     <ul>
      <li>
       <code>
        /condor-development-rhel4.repo
       </code>
       - A Repo Description File
      </li>
      <li>
       <code>
        /condor-development-rhel5.repo
       </code>
       - A Repo Description File
      </li>
      <li>
       <code>
        /condor-stable-rhel4.repo
       </code>
       - A Repo Description File
      </li>
      <li>
       <code>
        /condor-stable-rhel5.repo
       </code>
       - A Repo Description File
      </li>
     </ul>
    </li>
   </ul>
  </li>
 </ul>
 <p>
  Now we must modify the repo files to point to the mirrored repository.
These changes allow YUM requests against the mirror site to get the
right files from the right place.
 </p>
 <p>
 </p>
 <ol>
  <li>
   Modify the store repo files to contain the new url to the RPMs. The files
that must be modified are listed. The attribute which needs changing is the
   <strong>
    baseurl
   </strong>
   attribute in each of these files. This must point to a fully
qualified URL at the local mirror site.
   <ol>
    <li>
     <code>
      &lt;path&gt;/yum/repo.d/condor-development-rhel4.repo
     </code>
    </li>
    <li>
     <code>
      &lt;path&gt;/yum/repo.d/condor-development-rhel5.repo
     </code>
    </li>
    <li>
     <code>
      &lt;path&gt;/yum/repo.d/condor-stable-rhel4.repo
     </code>
    </li>
    <li>
     <code>
      &lt;path&gt;/yum/repo.d/condor-stable-rhel4.repo
     </code>
    </li>
   </ol>
  </li>
  <li>
   Update index files by executing the following commands.  This will
create/update the index files for each directory.
   <div class="code">
    <pre class="code">&gt; cd &lt;path&gt;/yum
&gt; createrepo stable/rhel4
&gt; createrepo stable/rhel5
&gt; createrepo development/rhel4
&gt; createrepo development/rhel5
</pre>
   </div>
  </li>
  <li>
   Optionally create a
   <code>
    &lt;path&gt;/yum/index.html
   </code>
   web page which describes
installation directions with links to the mirrored repository. An example
of such a page is
   <a class="external" href="http://www.cs.wisc.edu/condor/yum/index.html">
    here
   </a>
   . Once this page is created, its URL should be advertised so people
can easily find and use the mirror.
   <strong>
    Note:
   </strong>
   Do not copy the example page verbatim, as it will point to UW-Madison's HTCondor YUM repository!
  </li>
 </ol>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Collaborators known to mirror the HTCondor YUM repository
 </h3>
 <p>
 </p>
 <ul>
  <li>
   <span class="wiki">
    <a "LigoCollaboration" title="Ligo Collaboration">
     LigoCollaboration
    </a>
   </span>
  </li>
 </ul>
</div>
