---
title: Class Ad Conversion Todo
layout: wiki-page
---
<div id="content">
 <span class="section">
  <h2>
   ClassAd Conversion Todo List
  </h2>
 </span>
 <p>
  This is the set of tasks that need to be done to convert from old to new
  <span class="quote">
   ClassAds
  </span>
  . Code changes for this
  <span class="quote">
   ToDo
  </span>
  list should be associated with ticket
  <span class="ticket">
   <a class="resolved" href="tktview?tn=619" title="Write compatibility functions for conversion from old to new ClassAds">
    #619
   </a>
  </span>
  .
 </p>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Pre-Transition Tasks
 </h3>
 <p>
 </p>
 <ul>
  <li>
   Check in Varghese's
   <span class="quote">
    ClassAdList
   </span>
   class that works with new
   <span class="quote">
    ClassAds
   </span>
   .
   <strong>
    DONE
   </strong>
   <p>
   </p>
  </li>
  <li>
   Add a method to Varghese's new
   <span class="quote">
    ClassAdList
   </span>
   to move an ad from one list to another.
   <strong>
    DONE
   </strong>
   <p>
   </p>
  </li>
  <li>
   Add or fix compatibility for following old
   <span class="quote">
    ClassAd
   </span>
   methods:
   <ul>
    <li>
     Block
     <span class="quote">
      #1
     </span>
     <strong>
      [3 days]
     </strong>
     :
     <ul>
      <li>
       ClassAd::Assign()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::LookupString(MyString)
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::Insert(const char*)
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::Insert(const char*,ExprTree*)
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::Lookup()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::put()
       <strong>
        Theoretically code complete, needs testing.
       </strong>
      </li>
      <li>
       ClassAd::initFromStream()
       <strong>
        Theoretically code complete, needs testing.
       </strong>
      </li>
      <li>
       ClassAd::AssignExpr()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::clear()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::EvalString(const char*, const class AttrList*, char**)
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::EvalString(const char*, const class AttrList*, MyString&amp;)
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::NextNameOriginal()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::ResetName()
       <strong>
        DONE
       </strong>
      </li>
     </ul>
    </li>
    <li>
     Block
     <span class="quote">
      #2
     </span>
     <strong>
      [4 days]
     </strong>
     :
     <ul>
      <li>
       ClassAd::sPrintExpr()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::NextExpr()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::NextDirtyExpr()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::SetDirtyFlag()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::GetDirtyFlag()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::ClearAllDirtyFlags()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::GetReferences()
       <strong>
        INCOMPLETE
       </strong>
      </li>
      <li>
       ClassAd::ChainCollapse()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::EscapeStringValue()
       <strong>
        DONE, will need callsite changes
       </strong>
      </li>
      <li>
       ClassAd::CopyAttribute()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::fPrintAsXML()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::sPrintAsXML()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::IsValidAttrValue()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ExprTree::DeepCopy()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::initFromString()
       <strong>
        DONE
       </strong>
      </li>
      <li>
       ClassAd::GetExprReferences(const char*, StringList&amp;, StringList&amp;)
      </li>
     </ul>
    </li>
   </ul>
   <p>
   </p>
  </li>
  <li>
   Write helper functions for these methods which we can't emulate transparently
   <strong>
    [4 hours]
   </strong>
   :
   <ul>
    <li>
     ExprTree::PrintToNewStr()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::PrintToStr()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::EvalTree()
     <strong>
      DONE
     </strong>
    </li>
   </ul>
   <p>
   </p>
  </li>
  <li>
   Write compatibility versions of these free-standing functions that are part of old
   <span class="quote">
    ClassAds
   </span>
   :
   <ul>
    <li>
     int Parse(const char*s, MyString&amp;name, ExprTree*&amp;tree, int*pos = NULL)
     <strong>
      DONE
     </strong>
    </li>
    <li>
     int ParseClassAdRvalExpr(const char*s, ExprTree*&amp;tree, int*pos = NULL)
     <strong>
      DONE
     </strong>
    </li>
    <li>
     const char * ExprTreeToString( ExprTree*expr )
     <strong>
      DONE
     </strong>
    </li>
    <li>
     bool EvalBool(ClassAd * ad, const char * constraint)
     <strong>
      DONE
     </strong>
    </li>
    <li>
     bool EvalBool(AttrList * ad,
     <span class="wiki">
      <a class="missing" href="wiki-archiveExprTree" title="Expr Tree">
       ExprTree
      </a>
     </span>
     * tree)
     <strong>
      DONE
     </strong>
    </li>
    <li>
     bool ClassAdsAreSame(
     <span class="wiki">
      <a class="missing" href="wiki-archiveClassAd" title="Class Ad">
       ClassAd
      </a>
     </span>
     * ad1,
     <span class="wiki">
      <a class="missing" href="wiki-archiveClassAd" title="Class Ad">
       ClassAd
      </a>
     </span>
     * ad2,
     <span class="wiki">
      <a class="missing" href="wiki-archiveStringList" title="String List">
       StringList
      </a>
     </span>
     * ignored_attrs=NULL, bool verbose=false )
     <strong>
      DONE
     </strong>
    </li>
    <li>
     bool IsAMatch(const
     <span class="wiki">
      <a class="missing" href="wiki-archiveClassAd" title="Class Ad">
       ClassAd
      </a>
     </span>
     * ad1, const
     <span class="wiki">
      <a class="missing" href="wiki-archiveClassAd" title="Class Ad">
       ClassAd
      </a>
     </span>
     * ad2)
     <strong>
      DONE
     </strong>
    </li>
    <li>
     bool IsAHalfMatch(const
     <span class="wiki">
      <a class="missing" href="wiki-archiveClassAd" title="Class Ad">
       ClassAd
      </a>
     </span>
     * request, const
     <span class="wiki">
      <a class="missing" href="wiki-archiveClassAd" title="Class Ad">
       ClassAd
      </a>
     </span>
     * offer)
     <strong>
      DONE
     </strong>
    </li>
   </ul>
   <p>
   </p>
  </li>
  <li>
   Add
   <span class="quote">
    ClassAds
   </span>
   functions that are in old
   <span class="quote">
    ClassAds
   </span>
   but not in new
   <span class="quote">
    ClassAds
   </span>
   <strong>
    [2 days]
   </strong>
   :
   <ul>
    <li>
     <strong>
      Note: these are known as FunctionStringlistFOO, and are in condor_ast.cpp
     </strong>
    </li>
    <li>
     stringListSize()
    </li>
    <li>
     stringListSum()
    </li>
    <li>
     stringListAve()
    </li>
    <li>
     stringListMin()
    </li>
    <li>
     stringListMax()
    </li>
    <li>
     stringListMember()
    </li>
    <li>
     stringListIMember()
    </li>
    <li>
     stringListRegexpMember()
    </li>
   </ul>
   <p>
   </p>
  </li>
  <li>
   <span class="ticket">
    <a class="resolved" href="tktview?tn=952" title="Add configure switch to build with new / old classads">
     #952
    </a>
   </span>
   - Arrange header and make files so that switching between old and new
   <span class="quote">
    ClassAds
   </span>
   can be done with the flip of a switch.
   <strong>
    [1 day]
   </strong>
   .
   <p>
   </p>
  </li>
  <li>
   Fix up the one or two callsites in matchmaker.cpp that move an ad from one
   <span class="quote">
    ClassAdList
   </span>
   to another
   <strong>
    DONE
   </strong>
   .
   <p>
   </p>
  </li>
  <li>
   The following methods will need some fixing at the callsites
   <strong>
    [5 days]
   </strong>
   :
   <ul>
    <li>
     ExprTree::RArg()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::LArg()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::PrintToNewStr()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::EvalTree()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ClassAd(char*,char)
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::PrintToStr()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ExprTree::MyType()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ClassAd::ExchangeExpressions()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ClassAd::unchain()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     ClassAd::RestoreChain()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     AttrList::put()
     <strong>
      DONE
     </strong>
    </li>
    <li>
     AttrList::initFromStream()
     <strong>
      DONE
     </strong>
    </li>
   </ul>
   <p>
   </p>
  </li>
  <li>
   AttrList::SetPrivateAttributesInvisible() causes private attributes to be omitted from subsequent calls to fPrint(), sPrint(), dPrint() and putAttrList(). SetPrivateAttributesInvisible() needs to be added to
   <span class="quote">
    CompatClassAd
   </span>
   and its value needs to affect those subsequent calls.
   <strong>
    DONE
   </strong>
  </li>
 </ul>
 <p>
  <span class="subsection">
  </span>
 </p>
 <h3>
  Post-Transition Tasks
 </h3>
 <p>
 </p>
 <ul>
  <li>
   As time permits, rewrite callsites to make
   <span class="quote">
    CompatClassAd
   </span>
   unnecessary. The modified callsites can either use native new
   <span class="quote">
    ClassAd
   </span>
   methods or newly-written free-standing functions.
   <ul>
    <li>
     Replace all usage of attribute
     <span class="quote">
      CurrentTime
     </span>
     with
     <span class="quote">
      ClassAd
     </span>
     function time(). This can start before the flag day.
    </li>
   </ul>
  </li>
 </ul>
</div>
